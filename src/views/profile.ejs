<%- include('partials/head') %>
<link rel="stylesheet" href="/styles/profile.css" />
<%- include('partials/header') %>

<main>
  <% if (user) { %>
  <div class="profile-container">
    <div class="profile-header">
      <div class="profile-avatar">
        <img
          src="<%= user.profile_picture || '/images/default-avatar.png' %>"
          alt="Profile Picture"
          class="avatar-img"
          onerror="this.src='/images/default-avatar.png'"
        />
      </div>
      <div class="profile-info">
        <h1><%= user.name || 'Unknown User' %></h1>
        <p class="profile-email">
          <i class="fas fa-envelope"></i>
          <%= user.email || 'No email' %>
        </p>
        <p class="profile-role">
          <i class="fas fa-user-tag"></i>
          Role: <%= user.role || 'user' %>
        </p>
        <p class="profile-joined">
          <i class="fas fa-calendar-check"></i>
          Member since: <%= user.created_at ? new
          Date(user.created_at).toLocaleDateString() : 'Unknown' %>
        </p>
        <div class="profile-stats">
          <div class="profile-stat">
            <span class="profile-stat-value"
              ><%= enrolledCourses ? enrolledCourses.length : 0 %></span
            >
            <span class="profile-stat-label">Enrolled Courses</span>
          </div>
          <div class="profile-stat">
            <span class="profile-stat-value"
              ><%= user.created_at ? Math.ceil((new Date() - new
              Date(user.created_at)) / (1000 * 60 * 60 * 24)) : 0 %></span
            >
            <span class="profile-stat-label">Days Active</span>
          </div>
        </div>
      </div>
    </div>

    <div class="enrolled-courses">
      <h2><i class="fas fa-graduation-cap"></i> My Enrolled Courses</h2>
      <% if (enrolledCourses && enrolledCourses.length > 0) { %>
      <div class="enrolled-courses-grid">
        <% enrolledCourses.forEach(function(course) { %>
        <div class="enrolled-course-card">
          <div class="enrolled-course-header">
            <h3><a href="/courses/<%= course.id %>"><%= course.title %></a></h3>
            <div class="enrolled-course-category">
              <i class="fas fa-tag"></i>
              <%= course.category %>
            </div>
          </div>
          <div class="enrolled-course-body">
            <p class="enrolled-course-description"><%= course.description %></p>
            <div class="enrolled-course-meta">
              <span class="enrolled-date">
                <i class="fas fa-calendar-alt"></i>
                Enrolled: <%= new
                Date(course.enrollment_date).toLocaleDateString() %>
              </span>
            </div>
            <div
              class="course-actions"
              style="
                margin-top: var(--space-4);
                display: flex;
                gap: var(--space-3);
                align-items: center;
              "
            >
              <a
                href="/courses/<%= course.id %>"
                class="btn btn-primary btn-md"
              >
                <i class="fas fa-eye"></i> View Course
              </a>
              <form
                action="/user/unenroll/<%= course.id %>"
                method="POST"
                style="display: inline"
              >
                <button
                  type="submit"
                  class="btn btn-danger btn-md"
                  onclick="return confirm('Are you sure you want to unenroll from this course?')"
                >
                  <i class="fas fa-times"></i> Unenroll
                </button>
              </form>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
      <% } else { %>
      <div class="no-enrolled-courses">
        <div class="no-enrolled-courses-icon">
          <i class="fas fa-book-open"></i>
        </div>
        <h3>No Courses Enrolled Yet</h3>
        <p>
          Start your learning journey by exploring our available courses and
          enrolling in the ones that interest you.
        </p>
        <a href="/courses" class="btn-primary btn-lg">
          <i class="fas fa-search"></i> Browse Courses
        </a>
      </div>
      <% } %>
    </div>
  </div>
  <% } else { %>
  <div class="error-container">
    <h1>Profile Not Found</h1>
    <p>Unable to load profile information.</p>
    <a href="/auth/login" class="btn">Login</a>
  </div>
  <% } %>
</main>

<%- include('partials/footer') %>
